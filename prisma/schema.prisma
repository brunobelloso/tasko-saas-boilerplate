generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum OrgRole {
  OWNER
  ADMIN
  MEMBER
  VIEWER
}

enum NoteStatus {
  OPEN
  CLOSED
}

enum CampaignStatus {
  DRAFT
  ACTIVE
  CLOSED
}

enum FieldType {
  TEXT
  TEXTAREA
  NUMBER
  EMAIL
  PHONE
  DATE
  BOOLEAN
  SELECT
  URL
}

model Organization {
  id        String   @id @default(cuid())
  name      String
  slug      String   @unique
  logo      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  ownerId String

  members       OrganizationMember[]
  invites       OrganizationInvite[]
  notes         Note[]
  campaigns     Campaign[]
}

model OrganizationMember {
  id       String   @id @default(cuid())
  role     OrgRole  @default(MEMBER)
  joinedAt DateTime @default(now())

  userId String

  orgId        String
  organization Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)

  @@unique([userId, orgId])
}

model OrganizationInvite {
  id        String   @id @default(cuid())
  email     String
  role      OrgRole  @default(MEMBER)
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  orgId        String
  organization Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)

  invitedById String

  @@unique([email, orgId])
}

model Note {
  id        String     @id @default(cuid())
  title     String
  content   String
  status    NoteStatus @default(OPEN)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  authorId String

  orgId        String
  organization Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)

  comments NoteComment[]
}

model NoteComment {
  id        String   @id @default(cuid())
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  authorId String

  noteId String
  note   Note   @relation(fields: [noteId], references: [id], onDelete: Cascade)

  parentId String?
  parent   NoteComment?  @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies  NoteComment[] @relation("CommentReplies")
}

model Campaign {
  id          String         @id @default(cuid())
  name        String
  description String?
  status      CampaignStatus @default(DRAFT)
  slug        String         @unique
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  lastViewedAt DateTime?

  authorId String

  orgId        String
  organization Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)

  fields      CampaignField[]
  submissions CampaignSubmission[]
}

model CampaignField {
  id       String    @id @default(cuid())
  name     String
  type     FieldType @default(TEXT)
  required Boolean   @default(false)
  options  String?
  order    Int

  campaignId String
  campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
}

model CampaignSubmission {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())

  campaignId String
  campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  values CampaignSubmissionValue[]
}

model CampaignSubmissionValue {
  id    String @id @default(cuid())
  value String

  fieldId String

  submissionId String
  submission   CampaignSubmission @relation(fields: [submissionId], references: [id], onDelete: Cascade)
}
